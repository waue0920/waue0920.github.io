<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼æš‘æœŸå¯¦ç¿’è¨ˆç•« (æ•´åˆGemini API)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Visualization & Content Choices: 
        1. Weekly Plan Display: Content for each week (goals, resources, exercises, deliverables) updated according to user's new '%plan%'. 'Weekly Deliverables' section has enhanced styling. Specific URLs added to Week 1, 2, 3, and 4 content for relevant tools and concepts.
        2. Header Text: "Final Deliverables" section has a light yellow background. "Recommended Overall Learning Resources" includes NCHC link.
        3. Intelligent Learning Companion (Gemini): Prompts will use updated short_titles.
        4. Project Idea Generator (Week 8, Gemini): Prompt will use updated topics from the new plan.
        5. Resource Expansion Suggester (Gemini): Prompts will use updated short_titles.
    -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .nav-item {
            transition: all 0.2s ease-in-out;
        }
        .nav-item.active {
            background-color: #4A5568;
            color: #FFFFFF;
            transform: translateX(4px);
        }
        .nav-item:not(.active):hover {
            background-color: #E2E8F0;
            color: #2D3748;
        }
        .content-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .gemini-feature-card {
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1.5rem;
            background-color: #F9FAFB;
        }
        .gemini-button {
            background-color: #4A5568;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .gemini-button:hover {
            background-color: #2D3748;
        }
        .gemini-input {
            border: 1px solid #D1D5DB;
            padding: 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
        }
        .gemini-response {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 0.375rem;
            white-space: pre-wrap; 
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4A5568;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0.5rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .resource-list li {
            margin-bottom: 0.25rem;
        }
        .highlighted-deliverables {
            background-color: #E6FFFA; /* Light teal background */
            border: 1px solid #B2F5EA; /* Teal border */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .highlighted-deliverables h4 {
            color: #2C7A7B; /* Darker teal for title */
        }
        .highlighted-deliverables ul {
            color: #285E61; /* Slightly darker teal for list items */
        }
        .sub-item-link {
            margin-left: 1.5rem; /* Indent sub-items */
            display: block; /* Ensure links are on new lines if needed */
            font-size: 0.8rem; /* Slightly smaller font for links */
            color: #4299E1; /* Blue color for links */
        }
        .sub-item-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="w-full md:w-72 bg-gray-100 p-4 md:p-6 shadow-md md:shadow-none flex-shrink-0">
            <h1 class="text-xl md:text-2xl font-bold text-gray-700 mb-6 text-center md:text-left">å¯¦ç¿’é€±ç¨‹</h1>
            <nav id="navigation" class="flex md:flex-col justify-around md:justify-start">
            </nav>
        </aside>

        <main class="flex-1 p-4 md:p-8 lg:p-10">
            <header class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3">æš‘æœŸå¯¦ç¿’è¨ˆç•«ï¼šå¤šGPUç’°å¢ƒPyTorchæ·±åº¦å­¸ç¿’æ¨¡å‹é–‹ç™¼èˆ‡HPCå·¥å…·æ‡‰ç”¨</h2>
                <p class="text-gray-600 text-sm mb-2">
                    ç¸½ç›®æ¨™æ˜¯åŸ¹é¤Šæ‚¨åœ¨å¤šGPUç’°å¢ƒä¸‹ä½¿ç”¨PyTorché€²è¡Œæ·±åº¦å­¸ç¿’æ¨¡å‹é–‹ç™¼èˆ‡è¨“ç·´çš„èƒ½åŠ›ï¼Œä¸¦æŒæ¡Slurmèˆ‡Singularityç­‰HPCå·¥å…·çš„ä½¿ç”¨ã€‚
                </p>
                <div class="p-3 bg-yellow-50 border border-yellow-300 rounded-md mb-3">
                    <h4 class="font-semibold text-yellow-800 mb-1">æœ€çµ‚æˆæœå°‡åŒ…å«ï¼š</h4>
                    <ul class="list-disc list-inside text-yellow-700 text-xs resource-list">
                        <li>å­¸è¡“è«–æ–‡/æŠ€è¡“å ±å‘Š</li>
                        <li>Githubå°ˆæ¡ˆ</li>
                        <li>æˆæœç°¡å ±</li>                        
                   </ul>
                </div>
                <p class="text-gray-600 text-sm mb-2">
                    é€™æ˜¯ä¸€å€‹äº’å‹•å¼çš„å­¸ç¿’æŒ‡å—ï¼Œæ—¨åœ¨å”åŠ©æ‚¨å®Œæˆæ­¤æš‘æœŸå¯¦ç¿’è¨ˆç•«ã€‚
                </p>
                <div class="p-3 bg-indigo-50 border border-indigo-200 rounded-md mt-3">
                    <h4 class="font-semibold text-indigo-700 mb-1">å»ºè­°ç¸½é«”å­¸ç¿’è³‡æºï¼š</h4>
                    <ul class="list-disc list-inside text-indigo-600 text-xs resource-list">
                        <li>åœ‹ç¶²ä¸­å¿ƒGPUè·¨ç¯€é»è¨ˆç®— (<a href="nchc_gpu_hpc_slurm_2025.pdf" target="_blank" class="hover:underline">PDFè¬›ç¾©</a> / <a href="https://docs.google.com/presentation/d/1WKUXZJMqch0xUEPKZCN1cBLErxKtJ9P2/edit?slide=id.p1#slide=id.p1" target="_blank" class="hover:underline">Google Slides</a>)</li>
                        <li><a href="https://www.youtube.com/channel/UCmLiSKecyzKPKuA2MRGMJbQ" target="_blank" class="hover:underline">æå®æ¯…æ•™æˆæ©Ÿå™¨å­¸ç¿’/æ·±åº¦å­¸ç¿’èª²ç¨‹ (YouTube)</a> / <a href="https://www.bilibili.com/video/BV1JE411g7XF/" target="_blank" class="hover:underline">(Bilibili)</a></li>
                        <li><a href="https://www.youtube.com/c/AstonZhang" target="_blank" class="hover:underline">ææ²åšå£«è«–æ–‡ç²¾è®€ç³»åˆ— (YouTube)</a> / <a href="https://space.bilibili.com/156774845" target="_blank" class="hover:underline">(Bilibili)</a></li>
                        <li><a href="https://pytorch.org/docs/stable/index.html" target="_blank" class="hover:underline">PyTorchå®˜æ–¹æ–‡ä»¶ (pytorch.org)</a></li>
                        <li><a href="https://github.com/WongKinYiu/yolov9" target="_blank" class="hover:underline">YOLOv9å®˜æ–¹GitHubèˆ‡ç›¸é—œè«–æ–‡</a></li>
                        <li><a href="https://slurm.schedmd.com/documentation.html" target="_blank" class="hover:underline">Slurmå®˜æ–¹æ–‡ä»¶ (slurm.schedmd.com)</a></li>
                        <li><a href="https://apptainer.org/docs/" target="_blank" class="hover:underline">Singularity/Apptainerå®˜æ–¹æ–‡ä»¶ (apptainer.org)</a></li>
                    </ul>
                </div>
            </header>
            
            <section id="content-area" class="mt-8">
            </section>
        </main>
    </div>

    <script>
        const learningData = [
            {
                week: 1,
                title: "ç¬¬ä¸€é€±",
                short_title: "TWCC & PyTorch åŸºç¤",
                icon: "ğŸš€",
                content: {
                    goals: [
                        "äº†è§£ twcc å¦‚ä½•ä½¿ç”¨",
                        "<a href='https://man.twcc.ai/portal_man/container.html' target='_blank' class='sub-item-link'>â†³ åœ‹ç¶²ä¸­å¿ƒ TWCC å®¹å™¨é‹ç®—æœå‹™æ‰‹å†Š</a>"
                    ],
                    resources: [
                        "pytorch å­¸ç¿’",
                        "<a href='https://pytorch.org/tutorials/' target='_blank' class='sub-item-link'>â†³ PyTorch å®˜æ–¹æ•™å­¸ (Tutorials)</a>",
                        "twcc container ä½¿ç”¨æ–¹å¼",
                        "<a href='https://man.twcc.ai/portal_man/container.html' target='_blank' class='sub-item-link'>â†³ åœ‹ç¶²ä¸­å¿ƒ TWCC å®¹å™¨é‹ç®—æœå‹™æ‰‹å†Š</a>"
                    ],
                    exercises: [],
                    deliverables: ["ç”³è«‹ github / twcc account", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 2,
                title: "ç¬¬äºŒé€±",
                short_title: "Singularity & Slurm åŸºç¤",
                icon: "âš™ï¸",
                content: {
                    goals: [
                        "äº†è§£åœ‹ç¶²ä¸­å¿ƒçš„ slurm èˆ‡ singularityæ˜¯ä»€éº¼",
                        "<a href='https://slurm.schedmd.com/quickstart.html' target='_blank' class='sub-item-link'>â†³ Slurm å¿«é€Ÿå…¥é–€</a>",
                        "<a href='https://apptainer.org/docs/user/main/quick_start.html' target='_blank' class='sub-item-link'>â†³ Singularity/Apptainer å¿«é€Ÿå…¥é–€</a>",
                        "<span class='sub-item-link'>â†³ åƒè€ƒç¸½é«”è³‡æºä¸­çš„ã€Œåœ‹ç¶²ä¸­å¿ƒGPUè·¨ç¯€é»è¨ˆç®—ã€</span>"

                    ],
                    resources: [
                        "singularity å­¸ç¿’",
                        "<a href='https://apptainer.org/docs/user/main/' target='_blank' class='sub-item-link'>â†³ Singularity/Apptainer ä½¿ç”¨è€…æ‰‹å†Š</a>",
                        "slurm å­¸ç¿’",
                        "<a href='https://slurm.schedmd.com/documentation.html' target='_blank' class='sub-item-link'>â†³ Slurm å®˜æ–¹æ–‡ä»¶</a>"
                    ],
                    exercises: [],
                    deliverables: ["é€ job åˆ° twcc hpc", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 3,
                title: "ç¬¬ä¸‰é€±",
                short_title: "YOLOv9 åˆæ­¥",
                icon: "ğŸ¯",
                content: {
                    goals: [
                        "äº†è§£ yolo åŸç†",
                        "<a href='https://arxiv.org/abs/1506.02640' target='_blank' class='sub-item-link'>â†³ YOLO (åŸå§‹è«–æ–‡) - You Only Look Once: Unified, Real-Time Object Detection</a>"
                    ],
                    resources: [
                        "yolov9 å­¸ç¿’",
                        "<a href='https://github.com/WongKinYiu/yolov9' target='_blank' class='sub-item-link'>â†³ YOLOv9 GitHub Repository</a>",
                        "<a href='https://arxiv.org/abs/2402.13616' target='_blank' class='sub-item-link'>â†³ YOLOv9 è«–æ–‡ - Learning What You Want to Learn Using Programmable Gradient Information</a>",
                        "yolo æ¸¬è©¦", 
                        "yolo è¨“ç·´"
                    ],
                    exercises: [],
                    deliverables: ["ä½¿ç”¨yoloè¨“ç·´", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 4,
                title: "ç¬¬å››é€±",
                short_title: "å¤šGPUè¨“ç·´ & W&B",
                icon: "ğŸ“ˆ",
                content: {
                    goals: [
                        "å­¸ç¿’å¤šGPU/è·¨ç¯€é»è¨“ç·´",
                        "<a href='https://pytorch.org/tutorials/intermediate/ddp_tutorial.html' target='_blank' class='sub-item-link'>â†³ PyTorch DistributedDataParallel (DDP) æ•™å­¸</a>",
                        "å­¸ç¿’ä½¿ç”¨ wandb.ai"
                    ],
                    resources: [
                        "æ¥çºŒä¸Šé€±å…§å®¹ï¼Œæ”¹ç”¨å¤šgpu / è·¨ç¯€é»",
                        "wandb.ai",
                        "<a href='https://wandb.ai/site' target='_blank' class='sub-item-link'>â†³ Weights & Biases å®˜æ–¹ç¶²ç«™</a>",
                        "<a href='https://docs.wandb.ai/' target='_blank' class='sub-item-link'>â†³ Weights & Biases æ–‡ä»¶</a>"
                    ],
                    exercises: [],
                    deliverables: ["ä½¿ç”¨è‡ªå·±çš„å°ˆé¡Œè³‡æ–™é›†ç”¨yoloè¨“ç·´ï¼Œä¸¦æ­é…wandbè§€çœ‹çµæœ", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 5,
                title: "ç¬¬äº”é€±",
                short_title: "å°ˆé¡Œå¯¦é©— I & å ±å‘Šåˆç¨¿",
                icon: "ğŸ”¬",
                content: {
                    goals: ["å®Œæˆå°ˆé¡Œå¯¦é©—ç¬¬ä¸€éšæ®µç›®æ¨™"],
                    resources: [],
                    exercises: ["å°ˆé¡Œå¯¦é©—1", "å¯¦é©—ç ”ç©¶å ±å‘Šåˆç‰ˆ doc"],
                    deliverables: ["å°ˆé¡Œå¯¦é©—1 åˆæ­¥æˆæœ", "å¯¦é©—ç ”ç©¶å ±å‘Šåˆç‰ˆ doc", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 6,
                title: "ç¬¬å…­é€±",
                short_title: "å°ˆé¡Œå¯¦é©— II & å ±å‘Šæ’°å¯«",
                icon: "âœï¸",
                content: {
                    goals: ["å®Œæˆå°ˆé¡Œå¯¦é©—ç¬¬äºŒéšæ®µç›®æ¨™"],
                    resources: [],
                    exercises: ["å°ˆé¡Œå¯¦é©—2", "æ’°å¯«å¯¦é©—ç ”ç©¶å ±å‘Š doc"],
                    deliverables: ["å°ˆé¡Œå¯¦é©—2 æˆæœ", "å¯¦é©—ç ”ç©¶å ±å‘Š doc æ›´æ–°", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 7,
                title: "ç¬¬ä¸ƒé€±",
                short_title: "å°ˆé¡Œå¯¦é©— III & å ±å‘Š/ç°¡å ±",
                icon: "ğŸ“Š",
                content: {
                    goals: ["å®Œæˆå°ˆé¡Œå¯¦é©—ç¬¬ä¸‰éšæ®µä¸¦æ•´åˆæˆæœ", "æ·±å…¥ç›¸é—œPaperç ”ç©¶"],
                    resources: [],
                    exercises: ["å°ˆé¡Œå¯¦é©—3", "Paperç ”ç©¶", "æ’°å¯«å¯¦é©—ç ”ç©¶å ±å‘Š doc"],
                    deliverables: ["ç ”ç©¶å ±å‘Šdoc", "ç ”ç©¶å ±å‘Šppt", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            },
            {
                week: 8,
                title: "ç¬¬å…«é€±",
                short_title: "è«–æ–‡æ’°å¯« & ç¸½çµ",
                icon: "ğŸ“",
                content: {
                    goals: ["æ•´ç†æ‰€æœ‰å°ˆé¡Œå¯¦é©—æˆæœ", "å®Œæˆè«–æ–‡åˆç¨¿"],
                    resources: [],
                    exercises: ["æ•´ç†å°ˆé¡Œå¯¦é©—", "Paperç ”ç©¶", "æ’°å¯«è«–æ–‡"],
                    deliverables: ["è«–æ–‡åˆç¨¿", "GitHub ç¨‹å¼ç¢¼æäº¤", "æœ¬é€±é€²åº¦æŠ•å½±ç‰‡"]
                }
            }
        ];

        const navigationEl = document.getElementById('navigation');
        const contentAreaEl = document.getElementById('content-area');
        let currentWeek = 1;
        const apiKey = ""; 

        function renderNavigation() {
            navigationEl.innerHTML = learningData.map(item => `
                <button 
                    class="nav-item w-full text-left p-3 my-1 md:my-1.5 rounded-lg font-medium text-gray-600 ${item.week === currentWeek ? 'active' : ''}"
                    data-week="${item.week}">
                    <span class="mr-2 text-lg">${item.icon}</span>
                    <span class="hidden md:inline">ç¬¬ ${item.week} é€±</span>
                    <span class="md:hidden text-xs">${item.short_title}</span>
                </button>
            `).join('');

            document.querySelectorAll('.nav-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const week = parseInt(e.currentTarget.dataset.week);
                    updateContent(week);
                });
            });
        }
        
        function createContentBlock(title, items, icon, weekData = null, type = null) {
            if (!items || items.length === 0) return '';
            
            let blockClasses = "mb-6";
            let titleClasses = "text-xl font-semibold text-gray-700 border-b-2 border-gray-200 pb-2 mb-3 flex items-center";
            let listClasses = "list-disc list-inside space-y-2 text-gray-600 pl-2 text-sm";

            if (type === 'deliverables') {
                blockClasses = "highlighted-deliverables"; 
            }

            let displayTitle = title;
            if (type === 'goals') displayTitle = 'å­¸ç¿’é‡é»';
            else if (type === 'resources') displayTitle = 'å­¸ç¿’å…§å®¹';
            else if (type === 'exercises') displayTitle = 'å¯¦ä½œä»»å‹™';
            else if (type === 'deliverables') displayTitle = 'æ¯é€±æˆæœ';

            let blockHTML = `
                <div class="${blockClasses}">
                    <h4 class="${titleClasses}">
                       <span class="text-2xl mr-3">${icon}</span> ${displayTitle} 
                    </h4>
                    <ul class="${listClasses}">
                        ${items.map(item => {
                            if (item.startsWith("<a href=") || item.startsWith("<span class='sub-item-link'>")) {
                                return `<li class="list-none -ml-2">${item}</li>`; 
                            }
                            return `<li>${item.replace(/`([^`]+)`/g, '<code class="bg-gray-200 text-sm text-red-600 font-mono px-1 py-0.5 rounded">$1</code>')}</li>`;
                        }).join('')}
                    </ul>`;
            
            if (type === 'exercises' && weekData && weekData.week === 8) {
                blockHTML += `
                    <div class="gemini-feature-card">
                        <h5 class="text-md font-semibold text-gray-700 mb-2">âœ¨ å°ˆæ¡ˆé»å­ç”¢ç”Ÿå™¨</h5>
                        <p class="text-sm text-gray-500 mb-3">è®“ AI æ ¹æ“šå‰ä¸ƒé€±æ‰€å­¸ï¼Œç‚ºæ‚¨çš„æœ€çµ‚å°ˆæ¡ˆæä¾›æ›´å¤šå…ƒçš„éˆæ„Ÿã€‚</p>
                        <button id="generateProjectIdeasBtn" class="gemini-button text-sm">ç²å–å°ˆæ¡ˆé»å­</button>
                        <div id="projectIdeasLoader" class="loader hidden mt-2"></div>
                        <div id="projectIdeasResponse" class="gemini-response hidden"></div>
                    </div>`;
            }
            if (type === 'resources' && weekData) { 
                 blockHTML += `
                    <div class="gemini-feature-card">
                        <h5 class="text-md font-semibold text-gray-700 mb-2">âœ¨ æ“´å……è³‡æºå»ºè­°</h5>
                        <p class="text-sm text-gray-500 mb-3">è®“ AI é‡å°æœ¬é€±ä¸»é¡Œã€Œ${weekData.short_title}ã€æ¨è–¦æ›´å¤šå­¸ç¿’è³‡æºã€‚</p>
                        <button id="findMoreResourcesBtn" class="gemini-button text-sm">å°‹æ‰¾æ›´å¤šè³‡æº</button>
                        <div id="moreResourcesLoader" class="loader hidden mt-2"></div>
                        <div id="moreResourcesResponse" class="gemini-response hidden"></div>
                    </div>`;
            }

            blockHTML += `</div>`;
            return blockHTML;
        }

        function renderContent(week) {
            const data = learningData.find(item => item.week === week);
            if (!data) return;
            
            contentAreaEl.innerHTML = `
                <div class="content-card p-6 md:p-8 animate-fade-in">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">${data.title}</h3>
                    <p class="text-sm text-gray-500 mb-6">(${data.short_title})</p>

                    ${createContentBlock('å­¸ç¿’é‡é»', data.content.goals, 'ğŸ¯', data, 'goals')}
                    ${createContentBlock('å­¸ç¿’å…§å®¹', data.content.resources, 'ğŸ“–', data, 'resources')}
                    ${data.content.exercises && data.content.exercises.length > 0 ? createContentBlock('å¯¦ä½œä»»å‹™', data.content.exercises, 'ğŸ’»', data, 'exercises') : ''}
                    ${createContentBlock('æ¯é€±æˆæœ', data.content.deliverables, 'âœ…', data, 'deliverables')}

                    <div class="gemini-feature-card">
                        <h4 class="text-xl font-semibold text-gray-700 mb-3">âœ¨ æ™ºèƒ½å­¸ç¿’å¤¥ä¼´</h4>
                        <p class="text-sm text-gray-500 mb-3">å°æœ¬é€±ã€Œ${data.short_title}ã€æœ‰ä»»ä½•ç–‘å•å—ï¼Ÿå•å• AI å§ï¼</p>
                        <textarea id="askCompanionInput" class="gemini-input mb-2 text-sm" rows="3" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨é—œæ–¼ã€Œ${data.short_title}ã€çš„å•é¡Œ..."></textarea>
                        <button id="askCompanionBtn" class="gemini-button text-sm">ç™¼é€å•é¡Œ</button>
                        <div id="askCompanionLoader" class="loader hidden mt-2"></div>
                        <div id="askCompanionResponse" class="gemini-response hidden"></div>
                    </div>
                </div>
                <style>
                    @keyframes fade-in {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .animate-fade-in {
                        animation: fade-in 0.5s ease-in-out;
                    }
                </style>
            `;
            attachGeminiEventListeners(data);
        }
        
        function updateContent(week) {
            currentWeek = week;
            renderNavigation();
            renderContent(week);
        }
        
        async function callGeminiAPI(prompt, responseElementId, loaderElementId) {
            const responseEl = document.getElementById(responseElementId);
            const loaderEl = document.getElementById(loaderElementId);

            if (!responseEl || !loaderEl) return;

            loaderEl.classList.remove('hidden');
            responseEl.classList.add('hidden');
            responseEl.textContent = '';

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }]
                };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const res = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.error ? errorData.error.message : `API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${res.status}`);
                }

                const result = await res.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    responseEl.textContent = text;
                } else {
                    responseEl.textContent = 'æŠ±æ­‰ï¼ŒAI æœªèƒ½æä¾›æœ‰æ•ˆçš„å›è¦†ã€‚';
                }
            } catch (error) {
                console.error("Gemini API Error:", error);
                responseEl.textContent = `ç™¼ç”ŸéŒ¯èª¤ï¼š${error.message}\nï¼ˆå¦‚æœ API é‡‘é‘°æœªè¨­å®šï¼Œæ­¤åŠŸèƒ½å°‡ç„¡æ³•é‹ä½œã€‚ï¼‰`;
            } finally {
                loaderEl.classList.add('hidden');
                responseEl.classList.remove('hidden');
            }
        }

        function attachGeminiEventListeners(weekData) {
            const askCompanionBtn = document.getElementById('askCompanionBtn');
            if (askCompanionBtn) {
                askCompanionBtn.addEventListener('click', () => {
                    const input = document.getElementById('askCompanionInput');
                    if (input.value.trim() === '') {
                        alert('è«‹å…ˆè¼¸å…¥æ‚¨çš„å•é¡Œã€‚');
                        return;
                    }
                    const prompt = `æˆ‘æ­£åœ¨åƒèˆ‡ä¸€å€‹é—œæ–¼ã€Œå¤šGPUç’°å¢ƒPyTorchæ·±åº¦å­¸ç¿’æ¨¡å‹é–‹ç™¼èˆ‡HPCå·¥å…·æ‡‰ç”¨ã€çš„æš‘æœŸå¯¦ç¿’ã€‚ç›®å‰æ˜¯${weekData.title}ï¼Œä¸»é¡Œæ˜¯ã€Œ${weekData.short_title}ã€ã€‚é—œæ–¼é€™å€‹ä¸»é¡Œï¼Œæˆ‘æƒ³è«‹å•ï¼š${input.value}\nè«‹æä¾›ç°¡æ½”æ˜“æ‡‚çš„è§£é‡‹ï¼Œä¸¦è€ƒæ…®åˆ°æˆ‘æ­£åœ¨ç‚ºæœ€çµ‚çš„å­¸è¡“è«–æ–‡å’Œå°ˆæ¡ˆåšæº–å‚™ã€‚`;
                    callGeminiAPI(prompt, 'askCompanionResponse', 'askCompanionLoader');
                });
            }

            if (weekData.week === 8) {
                const generateProjectIdeasBtn = document.getElementById('generateProjectIdeasBtn');
                if (generateProjectIdeasBtn) {
                    generateProjectIdeasBtn.addEventListener('click', () => {
                        const learnedTopics = learningData.slice(0, 7).map(w => w.short_title).join(', ');
                        const prompt = `æˆ‘æ˜¯ä¸€åå³å°‡å®Œæˆç‚ºæœŸå…«é€±ã€Œå¤šGPUç’°å¢ƒPyTorchæ·±åº¦å­¸ç¿’æ¨¡å‹é–‹ç™¼èˆ‡HPCå·¥å…·æ‡‰ç”¨ã€æš‘æœŸå¯¦ç¿’çš„å­¸ç”Ÿã€‚æˆ‘å·²å­¸ç¿’äº†ä»¥ä¸‹ä¸»é¡Œï¼š${learnedTopics} (åŒ…å«PyTorch, TWCC, Singularity, Slurm, YOLOv9, å¤šGPUè¨“ç·´, wandb.ai)ã€‚æˆ‘æœ€çµ‚çš„æˆæœéœ€è¦åŒ…å«ä¸€å€‹GitHubå°ˆæ¡ˆå’Œä¸€ç¯‡å­¸è¡“è«–æ–‡/æŠ€è¡“å ±å‘Šåˆç¨¿ã€‚è«‹æ ¹æ“šæˆ‘æ‰€å­¸çš„å…§å®¹ï¼Œæä¾› 3-4 å€‹å…·é«”ä¸”æœ‰ç ”ç©¶åƒ¹å€¼çš„å°ˆæ¡ˆé»å­ï¼Œä¸¦ç°¡è¦èªªæ˜æ¯å€‹é»å­å¯ä»¥å¦‚ä½•å¯¦è¸ï¼Œä»¥åŠå¯èƒ½çš„å‰µæ–°é»æˆ–ç ”ç©¶æ–¹å‘ï¼Œä»¥ç¬¦åˆå­¸è¡“è«–æ–‡/æŠ€è¡“å ±å‘Šçš„è¦æ±‚ã€‚`;
                        callGeminiAPI(prompt, 'projectIdeasResponse', 'projectIdeasLoader');
                    });
                }
            }
            
            const findMoreResourcesBtn = document.getElementById('findMoreResourcesBtn');
            if (findMoreResourcesBtn && weekData.content.resources && weekData.content.resources.length > 0) { 
                findMoreResourcesBtn.addEventListener('click', () => {
                    const plainResources = weekData.content.resources.filter(r => !r.startsWith("<a href=") && !r.startsWith("<span class='sub-item-link'>")).join(', ');
                    const prompt = `æˆ‘æ­£åœ¨å­¸ç¿’${weekData.title}çš„ä¸»é¡Œï¼šã€Œ${weekData.short_title}ã€ï¼Œç›®å‰çš„å­¸ç¿’å…§å®¹åŒ…å«ï¼š${plainResources}ã€‚ç‚ºäº†æ›´æ·±å…¥ç†è§£ä¸¦ç‚ºæˆ‘çš„å°ˆæ¡ˆå’Œè«–æ–‡åšæº–å‚™ï¼Œè«‹æ¨è–¦ 2-3 å€‹èˆ‡é€™äº›å…§å®¹ç›¸é—œçš„é¡å¤–é€²éšå­¸ç¿’è³‡æºã€‚é€™äº›è³‡æºå¯ä»¥æ˜¯ç›¸é—œé ˜åŸŸçš„æœ€æ–°ç ”ç©¶è«–æ–‡ã€é‡è¦çš„é–‹æºå°ˆæ¡ˆã€æ·±å…¥çš„æŠ€è¡“éƒ¨è½æ ¼æ–‡ç« ã€æˆ–æœ‰ç”¨çš„å·¥å…·ã€‚è«‹æä¾›è³‡æºåç¨±ï¼Œå¦‚æœå¯èƒ½çš„è©±ï¼Œä¹Ÿé™„ä¸Šç°¡çŸ­æè¿°å…¶ç‚ºä½•é‡è¦æˆ–èˆ‡ä¸»é¡Œç›¸é—œã€‚`;
                    callGeminiAPI(prompt, 'moreResourcesResponse', 'moreResourcesLoader');
                });
            } else if (findMoreResourcesBtn) { 
                 const parentCard = findMoreResourcesBtn.closest('.gemini-feature-card');
                 if(parentCard) parentCard.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateContent(currentWeek); 
        });
    </script>
</body>
</html>
